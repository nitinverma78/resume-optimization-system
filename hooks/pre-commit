#!/bin/bash
# Git pre-commit hook: Validate no PII before committing

echo "üîí Running privacy validation before commit..."

# Run the privacy validator with uv to ensure dependencies are available
PYTHONPATH=. uv run python3 scripts/validate_git_privacy.py \
  --check-user "Nitin" \
  --check-email "nitin"

# Capture exit code
EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
    echo ""
    echo "‚ùå COMMIT BLOCKED: Privacy validation failed!"
    echo "   Remove PII from the files above before committing."
    echo "   To bypass (not recommended): git commit --no-verify"
    echo ""
    exit 1
fi

echo "‚úÖ Privacy check passed - proceeding with commit"
exit 0

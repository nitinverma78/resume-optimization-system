version: '3.8'

services:
  app:
    build: .
    image: resume-optimizer

    # Load variables from .env file automatically
    env_file:
      - .env

    environment:
      # Pass through variables from host .env to container
      - USER_NAME=${USER_NAME:?err}
      - USER_EMAIL=${USER_EMAIL:?err}

      # Internal container path for resumes (Fixed standard)
      - RESUME_FOLDER=/input_resumes

    volumes:
      # 1. INPUT: Map host resume folder (from .env) to internal /input_resumes
      # syntax: host_path:container_path:read_only
      - ${RESUME_FOLDER:?err}:/input_resumes:ro

      # 2. OUTPUT: Persist generated data to local ./data folder
      - ./data:/app/data

      # 3. CONFIG: Map config folder (for custom parsing rules/tests)
      - ./config:/app/config:ro

    # Default command: Run the full pipeline
    command: python main.py

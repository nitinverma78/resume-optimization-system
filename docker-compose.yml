version: '3.8'

services:
  # Demo mode - runs with Jane Doe simulation
  demo:
    build: .
    image: resume-optimizer
    command: python main.py --demo
    volumes:
      # Persist demo output for inspection
      - ./simulate/data:/app/simulate/data

  # Normal mode - requires .env and resume folder
  app:
    build: .
    image: resume-optimizer

    # Load variables from .env file automatically
    env_file:
      - .env

    environment:
      # Override RESUME_FOLDER to point to container mount point
      - RESUME_FOLDER=/input_resumes

    volumes:
      # 1. INPUT: Map host resume folder to /input_resumes
      # NOTE: Use absolute path, not ~. Expand ~ to full path in .env
      # Example: /Users/nitin/Downloads/MyResumeResources
      - ${HOME}/Downloads/MyResumeResources:/input_resumes:ro

      # 2. OUTPUT: Persist generated data to local ./data folder
      - ./data:/app/data

      # 3. CONFIG: Map config folder (for custom parsing rules/tests)
      - ./config:/app/config:ro

    # Default command: Run the full pipeline
    command: python main.py
